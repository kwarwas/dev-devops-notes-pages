{"pageProps":{"post":{"title":"Azure Container Apps infrastructure","date":"2022-10-09T19:45:00.000Z","tags":["devops","azure","container apps","infrastructure","terraform","terraform cloud"],"lastmod":"2022-10-09T00:00:00.000Z","draft":false,"summary":"In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud.","authors":["wlodziu","kornel"],"body":{"raw":"\n## Overview\n\n<TOCInline toc={props.toc} exclude=\"Overview\" toHeading={3} />\n\n## Intro\n\nThis article shows how to create the required Azure infrastructure to run our applications under Azure Container Apps.\nFor the Infrastructure as Code solution, we use Terraform scripts with Terraform Cloud free plan for state storage.\n\n## Required Azure resources\n\nTo deploy our applications under Azure Container Apps, we need additional Azure resources:\n\n- Resource Group\n- Container Apps Environment - an isolation boundary around groups of container apps\n- Log Analytics workspace - logs management, assign to Container Apps Environment\n- Azure Container Registry (ACR) - storage for docker images of our applications\n- User-Assigned Managed Identity - identity used by Azure Container Apps to pull images from ACR\n\n![azure-container-apps-infra-diagram](/static/images/devops/azure-container-apps/azure-container-apps-infra-diagram.png)\n\nThe Terraform script will not manage Container Apps resources in our solution. It is possible to create them using Terraform, but we prefer using a PowerShell script. In the case of Azure Container App, the Container App definition contains a container image definition and application settings definition (via environment variables and secrets). That means that the Container App definition will be changed very often, probably during each deployment of a new version of our applications. Therefore, this is an application deployment process, and Terraform role is infrastructure management. Similarly to K8s, where Terraform is not used in most cases for deploying K8s objects, this is a job for other mechanisms like Kubernetes manifests or Helm Scripts.\n\n## Terraform AzAPI provider\n\nAt the moment of creating this article, the official Azure Terraform provider, the AzureRM provider, with the current version of 3.26.0, is not supporting Azure Container Apps nor Azure Container Apps Environment yet. However, while waiting for this support, it is possible to manage those Azure resources with Terraform using the Terraform AzAPI provider. The AzAPI provider is a very thin layer on top of the Azure ARM REST APIs. It can be used as an alternative solution for managing Azure resources that are not yet or may never be supported by the AzureRM provider.\n\nMore about the AzAPI provider:\nhttps://registry.terraform.io/providers/Azure/azapi/latest/docs\n\nMore about creating Azure Container Apps in Terraform:\nhttps://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\n\nMicrosoft documentation for managing Azure Container Apps Environment using the AzAPI Terraform provider:\nhttps://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\n\nIn summary, in our Terraform script, we use two different providers:\n\n- AzAPI provider for managing Azure Container Apps Environment resource (inside Azure API called Managed Environment)\n- AzureRM provider for managing all other Azure resources\n\n## Terraform code\n\nFor Terraform state storage and script execution, we use Terraform Cloud service with a free plan. Therefore, it is essential to provide Azure tenant and subscription data along with the Service Principal data in configuration for every provider. Terraform Cloud agent will use this Service Principal to access and modify resources under a given Azure tenant and subscription.\n\n```hcl\nterraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"3.26.0\"\n    }\n    azapi = {\n      source  = \"Azure/azapi\"\n      version = \"1.0.0\"\n    }\n  }\n  cloud {\n    organization = \"dev-devops\"\n\n    workspaces {\n      name = \"azure_container_apps-dev\"\n    }\n  }\n}\n\nprovider \"azurerm\" {\n  features {}\n  subscription_id = \"<your-azure-subscription-id>\"\n  client_id       = \"<your-azure-service-principal-client-id>\"\n  client_secret   = \"<your-azure-service-principal-client-secret>\"\n  tenant_id       = \"<your-azure-tenant-id>\"\n}\n\nprovider \"azapi\" {\n  subscription_id = \"<your-azure-subscription-id>\"\n  client_id       = \"<your-azure-service-principal-client-id>\"\n  client_secret   = \"<your-azure-service-principal-client-secret>\"\n  tenant_id       = \"<your-azure-tenant-id>\"\n}\n\nlocals {\n  location             = \"North Europe\"\n  organization_name    = \"dev-devops\"\n  project_name         = \"aca\"\n  environment_name     = \"dev\"\n  resource_name_suffix = \"${local.organization_name}-${local.project_name}-${local.environment_name}\"\n  tags = {\n    Owner        = local.organization_name\n    Env          = local.environment_name\n    WorkloadName = local.project_name\n    Source       = \"Terraform\"\n  }\n  log_settings = {\n    sku               = \"PerGB2018\"\n    retention_in_days = 30\n    daily_quota_gb    = 1\n  }\n}\n\nresource \"azurerm_resource_group\" \"resource_group\" {\n  name     = \"rg-${local.resource_name_suffix}\"\n  location = local.location\n  tags     = local.tags\n}\n\nresource \"azurerm_log_analytics_workspace\" \"log_analytics_workspace\" {\n  name                = \"log-${local.resource_name_suffix}\"\n  resource_group_name = azurerm_resource_group.resource_group.name\n  location            = azurerm_resource_group.resource_group.location\n  sku                 = local.log_settings.sku\n  retention_in_days   = local.log_settings.retention_in_days\n  daily_quota_gb      = local.log_settings.daily_quota_gb\n  tags                = local.tags\n}\n\nresource \"azapi_resource\" \"resource_managed_environment\" {\n  type                   = \"Microsoft.App/managedEnvironments@2022-03-01\"\n  name                   = \"menv-${local.resource_name_suffix}\"\n  location               = azurerm_resource_group.resource_group.location\n  parent_id              = azurerm_resource_group.resource_group.id\n  tags                   = local.tags\n  response_export_values = [\"properties.staticIp\", \"properties.defaultDomain\"]\n  body = jsonencode({\n    properties = {\n      appLogsConfiguration = {\n        destination = \"log-analytics\"\n        logAnalyticsConfiguration = {\n          customerId = azurerm_log_analytics_workspace.log_analytics_workspace.workspace_id\n          sharedKey  = azurerm_log_analytics_workspace.log_analytics_workspace.primary_shared_key\n        }\n      }\n      zoneRedundant = false\n    }\n  })\n  ignore_missing_property = true\n}\n\nresource \"azurerm_container_registry\" \"container_registry\" {\n  name                          = \"cr${replace(local.resource_name_suffix, \"-\", \"\")}\"\n  resource_group_name           = azurerm_resource_group.resource_group.name\n  location                      = azurerm_resource_group.resource_group.location\n  sku                           = \"Basic\"\n  admin_enabled                 = false\n  public_network_access_enabled = true\n  network_rule_bypass_option    = \"None\"\n  tags                          = local.tags\n}\n\nresource \"azurerm_user_assigned_identity\" \"user_assigned_identity\" {\n  name                = \"id-${local.resource_name_suffix}\"\n  resource_group_name = azurerm_resource_group.resource_group.name\n  location            = azurerm_resource_group.resource_group.location\n  tags                = local.tags\n}\n\nresource \"azurerm_role_assignment\" \"role_assign\" {\n  scope                            = azurerm_container_registry.container_registry.id\n  role_definition_name             = \"AcrPull\"\n  principal_id                     = azurerm_user_assigned_identity.user_assigned_identity.principal_id\n  skip_service_principal_aad_check = true\n}\n```\n\nPlease mind the `ignore_missing_property = true` attribute setting for the managed environment resource. Adding this line is necessary to avoid problems with Terraform plan still founding changes after applying the configuration.\nMore about this: https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\n\n## Terraform Cloud\n\nThis is how the applied configuration looks like inside Terraform Cloud workspace:\n\n![azure-container-apps-infra-terraform-cloud](/static/images/devops/azure-container-apps/azure-container-apps-infra-terraform-cloud.png)\n\n## Azure Portal\n\nThis is how the applied configuration looks like on the Azure portal:\n\n![azure-container-apps-infra-azure-portal](/static/images/devops/azure-container-apps/azure-container-apps-infra-azure-portal.png)\n","code":"var Component=(()=>{var m=Object.create;var i=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=>{for(var s in e)i(a,s,{get:e[s],enumerable:!0})},l=(a,e,s,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of h(e))!k.call(a,r)&&r!==s&&i(a,r,{get:()=>e[r],enumerable:!(c=u(e,r))||c.enumerable});return a};var _=(a,e,s)=>(s=a!=null?m(N(a)):{},l(e||!a||!a.__esModule?i(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=>l(i({},\"__esModule\",{value:!0}),a);var t=g((T,o)=>{o.exports=_jsx_runtime});var A={};y(A,{default:()=>w,frontmatter:()=>z});var n=_(t()),z={title:\"Azure Container Apps infrastructure\",date:new Date(16653447e5),lastmod:\"2022-10-09\",tags:[\"devops\",\"azure\",\"container apps\",\"infrastructure\",\"terraform\",\"terraform cloud\"],draft:!1,summary:\"In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud.\",authors:[\"wlodziu\",\"kornel\"]};function p(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",div:\"div\",pre:\"pre\",code:\"code\"},a.components),{TOCInline:s,Image:c}=e;return c||d(\"Image\",!0),s||d(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"overview\",children:[(0,n.jsx)(e.a,{href:\"#overview\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Overview\"]}),(0,n.jsx)(s,{toc:a.toc,exclude:\"Overview\",toHeading:3}),(0,n.jsxs)(e.h2,{id:\"intro\",children:[(0,n.jsx)(e.a,{href:\"#intro\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Intro\"]}),(0,n.jsx)(e.p,{children:\"This article shows how to create the required Azure infrastructure to run our applications under Azure Container Apps. For the Infrastructure as Code solution, we use Terraform scripts with Terraform Cloud free plan for state storage.\"}),(0,n.jsxs)(e.h2,{id:\"required-azure-resources\",children:[(0,n.jsx)(e.a,{href:\"#required-azure-resources\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Required Azure resources\"]}),(0,n.jsx)(e.p,{children:\"To deploy our applications under Azure Container Apps, we need additional Azure resources:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Resource Group\"}),(0,n.jsx)(e.li,{children:\"Container Apps Environment - an isolation boundary around groups of container apps\"}),(0,n.jsx)(e.li,{children:\"Log Analytics workspace - logs management, assign to Container Apps Environment\"}),(0,n.jsx)(e.li,{children:\"Azure Container Registry (ACR) - storage for docker images of our applications\"}),(0,n.jsx)(e.li,{children:\"User-Assigned Managed Identity - identity used by Azure Container Apps to pull images from ACR\"})]}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-diagram\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-diagram.png\",width:\"457\",height:\"817\"})}),(0,n.jsx)(e.p,{children:\"The Terraform script will not manage Container Apps resources in our solution. It is possible to create them using Terraform, but we prefer using a PowerShell script. In the case of Azure Container App, the Container App definition contains a container image definition and application settings definition (via environment variables and secrets). That means that the Container App definition will be changed very often, probably during each deployment of a new version of our applications. Therefore, this is an application deployment process, and Terraform role is infrastructure management. Similarly to K8s, where Terraform is not used in most cases for deploying K8s objects, this is a job for other mechanisms like Kubernetes manifests or Helm Scripts.\"}),(0,n.jsxs)(e.h2,{id:\"terraform-azapi-provider\",children:[(0,n.jsx)(e.a,{href:\"#terraform-azapi-provider\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform AzAPI provider\"]}),(0,n.jsx)(e.p,{children:\"At the moment of creating this article, the official Azure Terraform provider, the AzureRM provider, with the current version of 3.26.0, is not supporting Azure Container Apps nor Azure Container Apps Environment yet. However, while waiting for this support, it is possible to manage those Azure resources with Terraform using the Terraform AzAPI provider. The AzAPI provider is a very thin layer on top of the Azure ARM REST APIs. It can be used as an alternative solution for managing Azure resources that are not yet or may never be supported by the AzureRM provider.\"}),(0,n.jsxs)(e.p,{children:[\"More about the AzAPI provider: \",(0,n.jsx)(e.a,{href:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs\",children:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs\"})]}),(0,n.jsxs)(e.p,{children:[\"More about creating Azure Container Apps in Terraform: \",(0,n.jsx)(e.a,{href:\"https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\",children:\"https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\"})]}),(0,n.jsxs)(e.p,{children:[\"Microsoft documentation for managing Azure Container Apps Environment using the AzAPI Terraform provider: \",(0,n.jsx)(e.a,{href:\"https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\",children:\"https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\"})]}),(0,n.jsx)(e.p,{children:\"In summary, in our Terraform script, we use two different providers:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"AzAPI provider for managing Azure Container Apps Environment resource (inside Azure API called Managed Environment)\"}),(0,n.jsx)(e.li,{children:\"AzureRM provider for managing all other Azure resources\"})]}),(0,n.jsxs)(e.h2,{id:\"terraform-code\",children:[(0,n.jsx)(e.a,{href:\"#terraform-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform code\"]}),(0,n.jsx)(e.p,{children:\"For Terraform state storage and script execution, we use Terraform Cloud service with a free plan. Therefore, it is essential to provide Azure tenant and subscription data along with the Service Principal data in configuration for every provider. Terraform Cloud agent will use this Service Principal to access and modify resources under a given Azure tenant and subscription.\"}),(0,n.jsx)(e.pre,{className:\"language-hcl\",children:(0,n.jsxs)(e.code,{className:\"language-hcl code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"terraform\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"required_providers\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"azurerm\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"source\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"hashicorp/azurerm\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"version\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"3.26.0\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"azapi\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"source\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Azure/azapi\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"version\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"1.0.0\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"cloud\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"organization\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-devops\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"workspaces\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"azure_container_apps-dev\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"provider\",(0,n.jsx)(e.span,{className:\"token type variable\",children:' \"azurerm\" '})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"features\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"subscription_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-subscription-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-service-principal-client-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_secret\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-service-principal-client-secret>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tenant_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-tenant-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"provider\",(0,n.jsx)(e.span,{className:\"token type variable\",children:' \"azapi\" '})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"subscription_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-subscription-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-service-principal-client-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_secret\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-service-principal-client-secret>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tenant_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"<your-azure-tenant-id>\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"locals\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"             \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"North Europe\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"organization_name\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-devops\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"project_name\"}),\"         \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"aca\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"environment_name\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_name_suffix\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"organization_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\"-\",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"project_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\"-\",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"environment_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Owner\"}),\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.organization_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Env\"}),\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.environment_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"WorkloadName\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.project_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Source\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Terraform\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"log_settings\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"               \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"PerGB2018\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"retention_in_days\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"daily_quota_gb\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_resource_group\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"resource_group\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"rg-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_log_analytics_workspace\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log_analytics_workspace\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"log-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"                 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.sku\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"retention_in_days\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.retention_in_days\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"daily_quota_gb\"}),\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.daily_quota_gb\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azapi_resource\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"resource_managed_environment\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"type\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Microsoft.App/managedEnvironments@2022-03-01\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"menv-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"               \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"parent_id\"}),\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"response_export_values\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"properties.staticIp\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"properties.defaultDomain\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"body\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"properties\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"appLogsConfiguration\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"destination\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log-analytics\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"logAnalyticsConfiguration\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token property\",children:\"customerId\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_log_analytics_workspace.log_analytics_workspace.workspace_id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sharedKey\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_log_analytics_workspace.log_analytics_workspace.primary_shared_key\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"zoneRedundant\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"ignore_missing_property\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_container_registry\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"container_registry\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"cr',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"-\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\"           \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"                      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"                           \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Basic\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"admin_enabled\"}),\"                 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"public_network_access_enabled\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"network_rule_bypass_option\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"None\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_user_assigned_identity\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"user_assigned_identity\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"id-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_role_assignment\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"role_assign\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"scope\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_container_registry.container_registry.id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"role_definition_name\"}),\"             \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AcrPull\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"principal_id\"}),\"                     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_user_assigned_identity.user_assigned_identity.principal_id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"skip_service_principal_aad_check\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Please mind the \",(0,n.jsx)(e.code,{children:\"ignore_missing_property = true\"}),\" attribute setting for the managed environment resource. Adding this line is necessary to avoid problems with Terraform plan still founding changes after applying the configuration. More about this: \",(0,n.jsx)(e.a,{href:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\",children:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\"})]}),(0,n.jsxs)(e.h2,{id:\"terraform-cloud\",children:[(0,n.jsx)(e.a,{href:\"#terraform-cloud\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform Cloud\"]}),(0,n.jsx)(e.p,{children:\"This is how the applied configuration looks like inside Terraform Cloud workspace:\"}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-terraform-cloud\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-terraform-cloud.png\",width:\"798\",height:\"1066\"})}),(0,n.jsxs)(e.h2,{id:\"azure-portal\",children:[(0,n.jsx)(e.a,{href:\"#azure-portal\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Azure Portal\"]}),(0,n.jsx)(e.p,{children:\"This is how the applied configuration looks like on the Azure portal:\"}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-azure-portal\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-azure-portal.png\",width:\"729\",height:\"727\"})})]})}function v(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(p,a)})):p(a)}var w=v;function d(a,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f(A);})();\n;return Component;"},"_id":"blog/devops/azure-container-apps-infra.mdx","_raw":{"sourceFilePath":"blog/devops/azure-container-apps-infra.mdx","sourceFileName":"azure-container-apps-infra.mdx","sourceFileDir":"blog/devops","contentType":"mdx","flattenedPath":"blog/devops/azure-container-apps-infra"},"type":"Blog","readingTime":{"text":"5 min read","minutes":4.05,"time":243000,"words":810},"slug":"devops/azure-container-apps-infra","toc":[{"value":"Overview","url":"#overview","depth":2},{"value":"Intro","url":"#intro","depth":2},{"value":"Required Azure resources","url":"#required-azure-resources","depth":2},{"value":"Terraform AzAPI provider","url":"#terraform-azapi-provider","depth":2},{"value":"Terraform code","url":"#terraform-code","depth":2},{"value":"Terraform Cloud","url":"#terraform-cloud","depth":2},{"value":"Azure Portal","url":"#azure-portal","depth":2}]},"authorDetails":[{"name":"Wodzimierz Kesler","avatar":"/static/images/wlodziu.jpg","occupation":"Team Leader / Senior Cloud Developer","company":"iteo","email":"wgkesler@gmail.com","linkedin":"https://www.linkedin.com/in/wgkesler/","type":"Authors","readingTime":{"text":"1 min read","minutes":0.455,"time":27300,"words":91},"slug":"wlodziu","toc":[]},{"name":"Kornel Warwas","avatar":"/static/images/kornel.jpeg","occupation":"Head of Web","company":"iteo","email":"kornel.warwas@gmail.com","linkedin":"https://www.linkedin.com/in/kornel-warwas/","github":"https://github.com/kwarwas","type":"Authors","readingTime":{"text":"1 min read","minutes":0.385,"time":23100,"words":77},"slug":"kornel","toc":[]}],"prev":{"title":"k3d, Prometheus, Grafana and k6","date":"2022-06-24T20:04:00.000Z","tags":["devops","k8s","k3d","k6"],"lastmod":"2022-06-24T00:00:00.000Z","draft":false,"summary":"In this article we introduce Kubernetes example monitoring solution using k3d, Prometheus and Grafana.","authors":["kornel","wlodziu"],"type":"Blog","readingTime":{"text":"5 min read","minutes":4.77,"time":286200,"words":954},"slug":"devops/k3d-prometheus-grafana","toc":[{"value":"Overview","url":"#overview","depth":2},{"value":"Intro","url":"#intro","depth":2},{"value":"Create single-node cluster","url":"#create-single-node-cluster","depth":2},{"value":"Check single-node cluster","url":"#check-single-node-cluster","depth":2},{"value":"Install kube-prometheus-stack","url":"#install-kube-prometheus-stack","depth":2},{"value":"Check kube-prometheus-stack deployment","url":"#check-kube-prometheus-stack-deployment","depth":2},{"value":"Get Grafana login password","url":"#get-grafana-login-password","depth":2},{"value":"Deploy sample application","url":"#deploy-sample-application","depth":2},{"value":"File structure","url":"#file-structure","depth":3},{"value":"hello-deployment.yml file","url":"#hello-deploymentyml-file","depth":3},{"value":"hello-service.yml file","url":"#hello-serviceyml-file","depth":3},{"value":"Deploy command","url":"#deploy-command","depth":3},{"value":"Check deployment","url":"#check-deployment","depth":3},{"value":"Run some HTTP requests","url":"#run-some-http-requests","depth":2},{"value":"Hello App port forwarding","url":"#hello-app-port-forwarding","depth":3},{"value":"Sample k6 script","url":"#sample-k6-script","depth":3},{"value":"Run k6 tests","url":"#run-k6-tests","depth":3},{"value":"Run Grafana","url":"#run-grafana","depth":2},{"value":"Port forwarding","url":"#port-forwarding","depth":3},{"value":"Login screen","url":"#login-screen","depth":3},{"value":"Dashboards","url":"#dashboards","depth":3},{"value":"Example screen 1","url":"#example-screen-1","depth":3},{"value":"Example screen 2","url":"#example-screen-2","depth":3},{"value":"Destroy Kubernetes cluster","url":"#destroy-kubernetes-cluster","depth":2},{"value":"What about multi-node cluster?","url":"#what-about-multi-node-cluster","depth":2},{"value":"Create multi-node cluster","url":"#create-multi-node-cluster","depth":3},{"value":"Check multi-node cluster","url":"#check-multi-node-cluster","depth":3},{"value":"Deploy kube-prometheus-stack","url":"#deploy-kube-prometheus-stack","depth":3}]},"next":null},"__N_SSG":true}