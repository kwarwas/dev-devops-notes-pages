<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Azure Container Apps infrastructure</title><meta name="robots" content="follow, index"/><meta name="description" content="In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud."/><meta property="og:url" content="dev-devops.com/blog/devops/azure-container-apps-infra"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Dev/DevOps Notes"/><meta property="og:description" content="In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud."/><meta property="og:title" content="Azure Container Apps infrastructure"/><meta property="og:image" content="dev-devops.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/Twitter"/><meta name="twitter:title" content="Azure Container Apps infrastructure"/><meta name="twitter:description" content="In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud."/><meta name="twitter:image" content="dev-devops.com/static/images/twitter-card.png"/><link rel="canonical" href="dev-devops.com/blog/devops/azure-container-apps-infra"/><meta property="article:published_time" content="2022-10-09T19:45:00.000Z"/><meta property="article:modified_time" content="2022-10-09T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "dev-devops.com/blog/devops/azure-container-apps-infra"
  },
  "headline": "Azure Container Apps infrastructure",
  "image": [
    {
      "@type": "ImageObject",
      "url": "dev-devops.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2022-10-09T19:45:00.000Z",
  "dateModified": "2022-10-09T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Włodzimierz Kesler"
    },
    {
      "@type": "Person",
      "name": "Kornel Warwas"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Dev/DevOps",
    "logo": {
      "@type": "ImageObject",
      "url": "dev-devops.com/static/images/logo.png"
    }
  },
  "description": "In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud."
}</script><meta name="next-head-count" content="21"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/13f97b7897b941eb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/13f97b7897b941eb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6d530d6069fd563f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6d530d6069fd563f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-8280016d1e506fe3.js" defer=""></script><script src="/_next/static/chunks/main-dfeaef147b0bbd63.js" defer=""></script><script src="/_next/static/chunks/pages/_app-249fe9c4db972ef9.js" defer=""></script><script src="/_next/static/chunks/829-a5989f7b1bb634cc.js" defer=""></script><script src="/_next/static/chunks/538-5e66050a2d5298aa.js" defer=""></script><script src="/_next/static/chunks/913-421ed17d38a5de56.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-d4d83d4ed12fd9ce.js" defer=""></script><script src="/_next/static/rlcKjeakqd5s7LdfsSEDu/_buildManifest.js" defer=""></script><script src="/_next/static/rlcKjeakqd5s7LdfsSEDu/_ssgManifest.js" defer=""></script><script src="/_next/static/rlcKjeakqd5s7LdfsSEDu/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Dev/DevOps Notes" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="344.564 330.278 111.737 91.218" width="53.87" height="43.61"><defs><linearGradient id="logo_svg__b" gradientUnits="userSpaceOnUse" x1="420.97" y1="331.28" x2="420.97" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><linearGradient id="logo_svg__d" gradientUnits="userSpaceOnUse" x1="377.89" y1="331.28" x2="377.89" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><path d="M453.3 331.28v28.57l-64.66 58.65v-30.08l64.66-57.14Z" id="logo_svg__a"></path><path d="M410.23 331.28v28.57l-64.67 58.65v-30.08l64.67-57.14Z" id="logo_svg__c"></path></defs><use xlink:href="#logo_svg__a" fill="url(#logo_svg__b)"></use><use xlink:href="#logo_svg__c" fill="url(#logo_svg__d)"></use></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Dev/DevOps Notes</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-24 right-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><button type="button" aria-label="toggle modal" class="fixed h-full w-full cursor-auto focus:outline-none"></button><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-10-09T19:45:00.000Z">Sunday, October 9, 2022</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Azure Container Apps infrastructure</h1></div><div class="pt-4 text-base font-medium leading-6 text-gray-500 dark:text-gray-400">5 min read</div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><div style="display:flex;justify-content:center"><div data-rmiz-wrap="visible"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" src="/static/images/wlodziu.jpg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></div><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Włodzimierz Kesler</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li><li class="flex items-center space-x-2"><div style="display:flex;justify-content:center"><div data-rmiz-wrap="visible"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2738%27%20height=%2738%27/%3e"/></span><img alt="avatar" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="h-10 w-10 rounded-full" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="avatar" src="/static/images/kornel.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="h-10 w-10 rounded-full" loading="lazy"/></noscript></span><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></div><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Kornel Warwas</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="overview"><a href="#overview" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Overview</h2><ul><li class="false"><a href="#intro">Intro</a></li><li class="false"><a href="#required-azure-resources">Required Azure resources</a></li><li class="false"><a href="#terraform-azapi-provider">Terraform AzAPI provider</a></li><li class="false"><a href="#terraform-code">Terraform code</a></li><li class="false"><a href="#terraform-cloud">Terraform Cloud</a></li><li class="false"><a href="#azure-portal">Azure Portal</a></li></ul><h2 id="intro"><a href="#intro" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Intro</h2><p>This article shows how to create the required Azure infrastructure to run our applications under Azure Container Apps. For the Infrastructure as Code solution, we use Terraform scripts with Terraform Cloud free plan for state storage.</p><h2 id="required-azure-resources"><a href="#required-azure-resources" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Required Azure resources</h2><p>To deploy our applications under Azure Container Apps, we need additional Azure resources:</p><ul><li>Resource Group</li><li>Container Apps Environment - an isolation boundary around groups of container apps</li><li>Log Analytics workspace - logs management, assign to Container Apps Environment</li><li>Azure Container Registry (ACR) - storage for docker images of our applications</li><li>User-Assigned Managed Identity - identity used by Azure Container Apps to pull images from ACR</li></ul><div><div style="display:flex;justify-content:center"><div data-rmiz-wrap="visible"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27457%27%20height=%27817%27/%3e"/></span><img alt="azure-container-apps-infra-diagram" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="azure-container-apps-infra-diagram" src="/static/images/devops/azure-container-apps/azure-container-apps-infra-diagram.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></div></div><p>The Terraform script will not manage Container Apps resources in our solution. It is possible to create them using Terraform, but we prefer using a PowerShell script. In the case of Azure Container App, the Container App definition contains a container image definition and application settings definition (via environment variables and secrets). That means that the Container App definition will be changed very often, probably during each deployment of a new version of our applications. Therefore, this is an application deployment process, and Terraform role is infrastructure management. Similarly to K8s, where Terraform is not used in most cases for deploying K8s objects, this is a job for other mechanisms like Kubernetes manifests or Helm Scripts.</p><h2 id="terraform-azapi-provider"><a href="#terraform-azapi-provider" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Terraform AzAPI provider</h2><p>At the moment of creating this article, the official Azure Terraform provider, the AzureRM provider, with the current version of 3.26.0, is not supporting Azure Container Apps nor Azure Container Apps Environment yet. However, while waiting for this support, it is possible to manage those Azure resources with Terraform using the Terraform AzAPI provider. The AzAPI provider is a very thin layer on top of the Azure ARM REST APIs. It can be used as an alternative solution for managing Azure resources that are not yet or may never be supported by the AzureRM provider.</p><p>More about the AzAPI provider: <a target="_blank" rel="noopener noreferrer" href="https://registry.terraform.io/providers/Azure/azapi/latest/docs">https://registry.terraform.io/providers/Azure/azapi/latest/docs</a></p><p>More about creating Azure Container Apps in Terraform: <a target="_blank" rel="noopener noreferrer" href="https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694">https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694</a></p><p>Microsoft documentation for managing Azure Container Apps Environment using the AzAPI Terraform provider: <a target="_blank" rel="noopener noreferrer" href="https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform">https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform</a></p><p>In summary, in our Terraform script, we use two different providers:</p><ul><li>AzAPI provider for managing Azure Container Apps Environment resource (inside Azure API called Managed Environment)</li><li>AzureRM provider for managing all other Azure resources</li></ul><h2 id="terraform-code"><a href="#terraform-code" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Terraform code</h2><p>For Terraform state storage and script execution, we use Terraform Cloud service with a free plan. Therefore, it is essential to provide Azure tenant and subscription data along with the Service Principal data in configuration for every provider. Terraform Cloud agent will use this Service Principal to access and modify resources under a given Azure tenant and subscription.</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">azurerm</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">&quot;hashicorp/azurerm&quot;</span>
</span><span class="code-line">      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;3.26.0&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token property">azapi</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">&quot;Azure/azapi&quot;</span>
</span><span class="code-line">      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0.0&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">cloud</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">organization</span> <span class="token punctuation">=</span> <span class="token string">&quot;dev-devops&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">workspaces</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;azure_container_apps-dev&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">provider<span class="token type variable"> &quot;azurerm&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">features</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token property">subscription_id</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-subscription-id&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">client_id</span>       <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-service-principal-client-id&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">client_secret</span>   <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-service-principal-client-secret&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">tenant_id</span>       <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-tenant-id&gt;&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">provider<span class="token type variable"> &quot;azapi&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">subscription_id</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-subscription-id&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">client_id</span>       <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-service-principal-client-id&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">client_secret</span>   <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-service-principal-client-secret&gt;&quot;</span>
</span><span class="code-line">  <span class="token property">tenant_id</span>       <span class="token punctuation">=</span> <span class="token string">&quot;&lt;your-azure-tenant-id&gt;&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">locals</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">location</span>             <span class="token punctuation">=</span> <span class="token string">&quot;North Europe&quot;</span>
</span><span class="code-line">  <span class="token property">organization_name</span>    <span class="token punctuation">=</span> <span class="token string">&quot;dev-devops&quot;</span>
</span><span class="code-line">  <span class="token property">project_name</span>         <span class="token punctuation">=</span> <span class="token string">&quot;aca&quot;</span>
</span><span class="code-line">  <span class="token property">environment_name</span>     <span class="token punctuation">=</span> <span class="token string">&quot;dev&quot;</span>
</span><span class="code-line">  <span class="token property">resource_name_suffix</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">organization_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">project_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">environment_name</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Owner</span>        <span class="token punctuation">=</span> local.organization_name
</span><span class="code-line">    <span class="token property">Env</span>          <span class="token punctuation">=</span> local.environment_name
</span><span class="code-line">    <span class="token property">WorkloadName</span> <span class="token punctuation">=</span> local.project_name
</span><span class="code-line">    <span class="token property">Source</span>       <span class="token punctuation">=</span> <span class="token string">&quot;Terraform&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token property">log_settings</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">sku</span>               <span class="token punctuation">=</span> <span class="token string">&quot;PerGB2018&quot;</span>
</span><span class="code-line">    <span class="token property">retention_in_days</span> <span class="token punctuation">=</span> <span class="token number">30</span>
</span><span class="code-line">    <span class="token property">daily_quota_gb</span>    <span class="token punctuation">=</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azurerm_resource_group&quot;</span></span> <span class="token string">&quot;resource_group&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>     <span class="token punctuation">=</span> <span class="token string">&quot;rg-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">resource_name_suffix</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">location</span> <span class="token punctuation">=</span> local.location
</span><span class="code-line">  <span class="token property">tags</span>     <span class="token punctuation">=</span> local.tags
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azurerm_log_analytics_workspace&quot;</span></span> <span class="token string">&quot;log_analytics_workspace&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">&quot;log-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">resource_name_suffix</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.resource_group.name
</span><span class="code-line">  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.resource_group.location
</span><span class="code-line">  <span class="token property">sku</span>                 <span class="token punctuation">=</span> local.log_settings.sku
</span><span class="code-line">  <span class="token property">retention_in_days</span>   <span class="token punctuation">=</span> local.log_settings.retention_in_days
</span><span class="code-line">  <span class="token property">daily_quota_gb</span>      <span class="token punctuation">=</span> local.log_settings.daily_quota_gb
</span><span class="code-line">  <span class="token property">tags</span>                <span class="token punctuation">=</span> local.tags
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azapi_resource&quot;</span></span> <span class="token string">&quot;resource_managed_environment&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">type</span>                   <span class="token punctuation">=</span> <span class="token string">&quot;Microsoft.App/managedEnvironments@2022-03-01&quot;</span>
</span><span class="code-line">  <span class="token property">name</span>                   <span class="token punctuation">=</span> <span class="token string">&quot;menv-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">resource_name_suffix</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">location</span>               <span class="token punctuation">=</span> azurerm_resource_group.resource_group.location
</span><span class="code-line">  <span class="token property">parent_id</span>              <span class="token punctuation">=</span> azurerm_resource_group.resource_group.id
</span><span class="code-line">  <span class="token property">tags</span>                   <span class="token punctuation">=</span> local.tags
</span><span class="code-line">  <span class="token property">response_export_values</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;properties.staticIp&quot;</span>, <span class="token string">&quot;properties.defaultDomain&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token property">body</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">properties</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">appLogsConfiguration</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">destination</span> <span class="token punctuation">=</span> <span class="token string">&quot;log-analytics&quot;</span>
</span><span class="code-line">        <span class="token property">logAnalyticsConfiguration</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">customerId</span> <span class="token punctuation">=</span> azurerm_log_analytics_workspace.log_analytics_workspace.workspace_id
</span><span class="code-line">          <span class="token property">sharedKey</span>  <span class="token punctuation">=</span> azurerm_log_analytics_workspace.log_analytics_workspace.primary_shared_key
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">      <span class="token property">zoneRedundant</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line">  <span class="token property">ignore_missing_property</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azurerm_container_registry&quot;</span></span> <span class="token string">&quot;container_registry&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>                          <span class="token punctuation">=</span> <span class="token string">&quot;cr<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">resource_name_suffix</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">resource_group_name</span>           <span class="token punctuation">=</span> azurerm_resource_group.resource_group.name
</span><span class="code-line">  <span class="token property">location</span>                      <span class="token punctuation">=</span> azurerm_resource_group.resource_group.location
</span><span class="code-line">  <span class="token property">sku</span>                           <span class="token punctuation">=</span> <span class="token string">&quot;Basic&quot;</span>
</span><span class="code-line">  <span class="token property">admin_enabled</span>                 <span class="token punctuation">=</span> <span class="token boolean">false</span>
</span><span class="code-line">  <span class="token property">public_network_access_enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">  <span class="token property">network_rule_bypass_option</span>    <span class="token punctuation">=</span> <span class="token string">&quot;None&quot;</span>
</span><span class="code-line">  <span class="token property">tags</span>                          <span class="token punctuation">=</span> local.tags
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azurerm_user_assigned_identity&quot;</span></span> <span class="token string">&quot;user_assigned_identity&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>                <span class="token punctuation">=</span> <span class="token string">&quot;id-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">resource_name_suffix</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> azurerm_resource_group.resource_group.name
</span><span class="code-line">  <span class="token property">location</span>            <span class="token punctuation">=</span> azurerm_resource_group.resource_group.location
</span><span class="code-line">  <span class="token property">tags</span>                <span class="token punctuation">=</span> local.tags
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;azurerm_role_assignment&quot;</span></span> <span class="token string">&quot;role_assign&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">scope</span>                            <span class="token punctuation">=</span> azurerm_container_registry.container_registry.id
</span><span class="code-line">  <span class="token property">role_definition_name</span>             <span class="token punctuation">=</span> <span class="token string">&quot;AcrPull&quot;</span>
</span><span class="code-line">  <span class="token property">principal_id</span>                     <span class="token punctuation">=</span> azurerm_user_assigned_identity.user_assigned_identity.principal_id
</span><span class="code-line">  <span class="token property">skip_service_principal_aad_check</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Please mind the <code>ignore_missing_property = true</code> attribute setting for the managed environment resource. Adding this line is necessary to avoid problems with Terraform plan still founding changes after applying the configuration. More about this: <a target="_blank" rel="noopener noreferrer" href="https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions">https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions</a></p><h2 id="terraform-cloud"><a href="#terraform-cloud" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Terraform Cloud</h2><p>This is how the applied configuration looks like inside Terraform Cloud workspace:</p><div><div style="display:flex;justify-content:center"><div data-rmiz-wrap="visible"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27798%27%20height=%271066%27/%3e"/></span><img alt="azure-container-apps-infra-terraform-cloud" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="azure-container-apps-infra-terraform-cloud" src="/static/images/devops/azure-container-apps/azure-container-apps-infra-terraform-cloud.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></div></div><h2 id="azure-portal"><a href="#azure-portal" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Azure Portal</h2><p>This is how the applied configuration looks like on the Azure portal:</p><div><div style="display:flex;justify-content:center"><div data-rmiz-wrap="visible"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27729%27%20height=%27727%27/%3e"/></span><img alt="azure-container-apps-infra-azure-portal" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="azure-container-apps-infra-azure-portal" src="/static/images/devops/azure-container-apps/azure-container-apps-infra-azure-portal.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></div></div></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/devops">devops</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/azure">azure</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/container-apps">container-apps</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/infrastructure">infrastructure</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">terraform</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform-cloud">terraform-cloud</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/devops/k3d-prometheus-grafana">k3d, Prometheus, Grafana and k6</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:info@dev-devops.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Dev/DevOps</div><div> • </div><div>© 2022</div><div> • </div><a href="/">Dev/DevOps Notes</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Azure Container Apps infrastructure","date":"2022-10-09T19:45:00.000Z","tags":["devops","azure","container apps","infrastructure","terraform","terraform cloud"],"lastmod":"2022-10-09T00:00:00.000Z","draft":false,"summary":"In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud.","authors":["wlodziu","kornel"],"body":{"raw":"\n## Overview\n\n\u003cTOCInline toc={props.toc} exclude=\"Overview\" toHeading={3} /\u003e\n\n## Intro\n\nThis article shows how to create the required Azure infrastructure to run our applications under Azure Container Apps.\nFor the Infrastructure as Code solution, we use Terraform scripts with Terraform Cloud free plan for state storage.\n\n## Required Azure resources\n\nTo deploy our applications under Azure Container Apps, we need additional Azure resources:\n\n- Resource Group\n- Container Apps Environment - an isolation boundary around groups of container apps\n- Log Analytics workspace - logs management, assign to Container Apps Environment\n- Azure Container Registry (ACR) - storage for docker images of our applications\n- User-Assigned Managed Identity - identity used by Azure Container Apps to pull images from ACR\n\n![azure-container-apps-infra-diagram](/static/images/devops/azure-container-apps/azure-container-apps-infra-diagram.png)\n\nThe Terraform script will not manage Container Apps resources in our solution. It is possible to create them using Terraform, but we prefer using a PowerShell script. In the case of Azure Container App, the Container App definition contains a container image definition and application settings definition (via environment variables and secrets). That means that the Container App definition will be changed very often, probably during each deployment of a new version of our applications. Therefore, this is an application deployment process, and Terraform role is infrastructure management. Similarly to K8s, where Terraform is not used in most cases for deploying K8s objects, this is a job for other mechanisms like Kubernetes manifests or Helm Scripts.\n\n## Terraform AzAPI provider\n\nAt the moment of creating this article, the official Azure Terraform provider, the AzureRM provider, with the current version of 3.26.0, is not supporting Azure Container Apps nor Azure Container Apps Environment yet. However, while waiting for this support, it is possible to manage those Azure resources with Terraform using the Terraform AzAPI provider. The AzAPI provider is a very thin layer on top of the Azure ARM REST APIs. It can be used as an alternative solution for managing Azure resources that are not yet or may never be supported by the AzureRM provider.\n\nMore about the AzAPI provider:\nhttps://registry.terraform.io/providers/Azure/azapi/latest/docs\n\nMore about creating Azure Container Apps in Terraform:\nhttps://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\n\nMicrosoft documentation for managing Azure Container Apps Environment using the AzAPI Terraform provider:\nhttps://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\n\nIn summary, in our Terraform script, we use two different providers:\n\n- AzAPI provider for managing Azure Container Apps Environment resource (inside Azure API called Managed Environment)\n- AzureRM provider for managing all other Azure resources\n\n## Terraform code\n\nFor Terraform state storage and script execution, we use Terraform Cloud service with a free plan. Therefore, it is essential to provide Azure tenant and subscription data along with the Service Principal data in configuration for every provider. Terraform Cloud agent will use this Service Principal to access and modify resources under a given Azure tenant and subscription.\n\n```hcl\nterraform {\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"3.26.0\"\n    }\n    azapi = {\n      source  = \"Azure/azapi\"\n      version = \"1.0.0\"\n    }\n  }\n  cloud {\n    organization = \"dev-devops\"\n\n    workspaces {\n      name = \"azure_container_apps-dev\"\n    }\n  }\n}\n\nprovider \"azurerm\" {\n  features {}\n  subscription_id = \"\u003cyour-azure-subscription-id\u003e\"\n  client_id       = \"\u003cyour-azure-service-principal-client-id\u003e\"\n  client_secret   = \"\u003cyour-azure-service-principal-client-secret\u003e\"\n  tenant_id       = \"\u003cyour-azure-tenant-id\u003e\"\n}\n\nprovider \"azapi\" {\n  subscription_id = \"\u003cyour-azure-subscription-id\u003e\"\n  client_id       = \"\u003cyour-azure-service-principal-client-id\u003e\"\n  client_secret   = \"\u003cyour-azure-service-principal-client-secret\u003e\"\n  tenant_id       = \"\u003cyour-azure-tenant-id\u003e\"\n}\n\nlocals {\n  location             = \"North Europe\"\n  organization_name    = \"dev-devops\"\n  project_name         = \"aca\"\n  environment_name     = \"dev\"\n  resource_name_suffix = \"${local.organization_name}-${local.project_name}-${local.environment_name}\"\n  tags = {\n    Owner        = local.organization_name\n    Env          = local.environment_name\n    WorkloadName = local.project_name\n    Source       = \"Terraform\"\n  }\n  log_settings = {\n    sku               = \"PerGB2018\"\n    retention_in_days = 30\n    daily_quota_gb    = 1\n  }\n}\n\nresource \"azurerm_resource_group\" \"resource_group\" {\n  name     = \"rg-${local.resource_name_suffix}\"\n  location = local.location\n  tags     = local.tags\n}\n\nresource \"azurerm_log_analytics_workspace\" \"log_analytics_workspace\" {\n  name                = \"log-${local.resource_name_suffix}\"\n  resource_group_name = azurerm_resource_group.resource_group.name\n  location            = azurerm_resource_group.resource_group.location\n  sku                 = local.log_settings.sku\n  retention_in_days   = local.log_settings.retention_in_days\n  daily_quota_gb      = local.log_settings.daily_quota_gb\n  tags                = local.tags\n}\n\nresource \"azapi_resource\" \"resource_managed_environment\" {\n  type                   = \"Microsoft.App/managedEnvironments@2022-03-01\"\n  name                   = \"menv-${local.resource_name_suffix}\"\n  location               = azurerm_resource_group.resource_group.location\n  parent_id              = azurerm_resource_group.resource_group.id\n  tags                   = local.tags\n  response_export_values = [\"properties.staticIp\", \"properties.defaultDomain\"]\n  body = jsonencode({\n    properties = {\n      appLogsConfiguration = {\n        destination = \"log-analytics\"\n        logAnalyticsConfiguration = {\n          customerId = azurerm_log_analytics_workspace.log_analytics_workspace.workspace_id\n          sharedKey  = azurerm_log_analytics_workspace.log_analytics_workspace.primary_shared_key\n        }\n      }\n      zoneRedundant = false\n    }\n  })\n  ignore_missing_property = true\n}\n\nresource \"azurerm_container_registry\" \"container_registry\" {\n  name                          = \"cr${replace(local.resource_name_suffix, \"-\", \"\")}\"\n  resource_group_name           = azurerm_resource_group.resource_group.name\n  location                      = azurerm_resource_group.resource_group.location\n  sku                           = \"Basic\"\n  admin_enabled                 = false\n  public_network_access_enabled = true\n  network_rule_bypass_option    = \"None\"\n  tags                          = local.tags\n}\n\nresource \"azurerm_user_assigned_identity\" \"user_assigned_identity\" {\n  name                = \"id-${local.resource_name_suffix}\"\n  resource_group_name = azurerm_resource_group.resource_group.name\n  location            = azurerm_resource_group.resource_group.location\n  tags                = local.tags\n}\n\nresource \"azurerm_role_assignment\" \"role_assign\" {\n  scope                            = azurerm_container_registry.container_registry.id\n  role_definition_name             = \"AcrPull\"\n  principal_id                     = azurerm_user_assigned_identity.user_assigned_identity.principal_id\n  skip_service_principal_aad_check = true\n}\n```\n\nPlease mind the `ignore_missing_property = true` attribute setting for the managed environment resource. Adding this line is necessary to avoid problems with Terraform plan still founding changes after applying the configuration.\nMore about this: https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\n\n## Terraform Cloud\n\nThis is how the applied configuration looks like inside Terraform Cloud workspace:\n\n![azure-container-apps-infra-terraform-cloud](/static/images/devops/azure-container-apps/azure-container-apps-infra-terraform-cloud.png)\n\n## Azure Portal\n\nThis is how the applied configuration looks like on the Azure portal:\n\n![azure-container-apps-infra-azure-portal](/static/images/devops/azure-container-apps/azure-container-apps-infra-azure-portal.png)\n","code":"var Component=(()=\u003e{var m=Object.create;var i=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var g=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),y=(a,e)=\u003e{for(var s in e)i(a,s,{get:e[s],enumerable:!0})},l=(a,e,s,c)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let r of h(e))!k.call(a,r)\u0026\u0026r!==s\u0026\u0026i(a,r,{get:()=\u003ee[r],enumerable:!(c=u(e,r))||c.enumerable});return a};var _=(a,e,s)=\u003e(s=a!=null?m(N(a)):{},l(e||!a||!a.__esModule?i(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=\u003el(i({},\"__esModule\",{value:!0}),a);var t=g((T,o)=\u003e{o.exports=_jsx_runtime});var A={};y(A,{default:()=\u003ew,frontmatter:()=\u003ez});var n=_(t()),z={title:\"Azure Container Apps infrastructure\",date:new Date(16653447e5),lastmod:\"2022-10-09\",tags:[\"devops\",\"azure\",\"container apps\",\"infrastructure\",\"terraform\",\"terraform cloud\"],draft:!1,summary:\"In this article we introduce Azure Container Apps infrastructure using IaC approach with Terraform Cloud.\",authors:[\"wlodziu\",\"kornel\"]};function p(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",div:\"div\",pre:\"pre\",code:\"code\"},a.components),{TOCInline:s,Image:c}=e;return c||d(\"Image\",!0),s||d(\"TOCInline\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"overview\",children:[(0,n.jsx)(e.a,{href:\"#overview\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Overview\"]}),(0,n.jsx)(s,{toc:a.toc,exclude:\"Overview\",toHeading:3}),(0,n.jsxs)(e.h2,{id:\"intro\",children:[(0,n.jsx)(e.a,{href:\"#intro\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Intro\"]}),(0,n.jsx)(e.p,{children:\"This article shows how to create the required Azure infrastructure to run our applications under Azure Container Apps. For the Infrastructure as Code solution, we use Terraform scripts with Terraform Cloud free plan for state storage.\"}),(0,n.jsxs)(e.h2,{id:\"required-azure-resources\",children:[(0,n.jsx)(e.a,{href:\"#required-azure-resources\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Required Azure resources\"]}),(0,n.jsx)(e.p,{children:\"To deploy our applications under Azure Container Apps, we need additional Azure resources:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Resource Group\"}),(0,n.jsx)(e.li,{children:\"Container Apps Environment - an isolation boundary around groups of container apps\"}),(0,n.jsx)(e.li,{children:\"Log Analytics workspace - logs management, assign to Container Apps Environment\"}),(0,n.jsx)(e.li,{children:\"Azure Container Registry (ACR) - storage for docker images of our applications\"}),(0,n.jsx)(e.li,{children:\"User-Assigned Managed Identity - identity used by Azure Container Apps to pull images from ACR\"})]}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-diagram\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-diagram.png\",width:\"457\",height:\"817\"})}),(0,n.jsx)(e.p,{children:\"The Terraform script will not manage Container Apps resources in our solution. It is possible to create them using Terraform, but we prefer using a PowerShell script. In the case of Azure Container App, the Container App definition contains a container image definition and application settings definition (via environment variables and secrets). That means that the Container App definition will be changed very often, probably during each deployment of a new version of our applications. Therefore, this is an application deployment process, and Terraform role is infrastructure management. Similarly to K8s, where Terraform is not used in most cases for deploying K8s objects, this is a job for other mechanisms like Kubernetes manifests or Helm Scripts.\"}),(0,n.jsxs)(e.h2,{id:\"terraform-azapi-provider\",children:[(0,n.jsx)(e.a,{href:\"#terraform-azapi-provider\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform AzAPI provider\"]}),(0,n.jsx)(e.p,{children:\"At the moment of creating this article, the official Azure Terraform provider, the AzureRM provider, with the current version of 3.26.0, is not supporting Azure Container Apps nor Azure Container Apps Environment yet. However, while waiting for this support, it is possible to manage those Azure resources with Terraform using the Terraform AzAPI provider. The AzAPI provider is a very thin layer on top of the Azure ARM REST APIs. It can be used as an alternative solution for managing Azure resources that are not yet or may never be supported by the AzureRM provider.\"}),(0,n.jsxs)(e.p,{children:[\"More about the AzAPI provider: \",(0,n.jsx)(e.a,{href:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs\",children:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs\"})]}),(0,n.jsxs)(e.p,{children:[\"More about creating Azure Container Apps in Terraform: \",(0,n.jsx)(e.a,{href:\"https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\",children:\"https://techcommunity.microsoft.com/t5/fasttrack-for-azure/can-i-create-an-azure-container-apps-in-terraform-yes-you-can/ba-p/3570694\"})]}),(0,n.jsxs)(e.p,{children:[\"Microsoft documentation for managing Azure Container Apps Environment using the AzAPI Terraform provider: \",(0,n.jsx)(e.a,{href:\"https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\",children:\"https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-terraform\"})]}),(0,n.jsx)(e.p,{children:\"In summary, in our Terraform script, we use two different providers:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"AzAPI provider for managing Azure Container Apps Environment resource (inside Azure API called Managed Environment)\"}),(0,n.jsx)(e.li,{children:\"AzureRM provider for managing all other Azure resources\"})]}),(0,n.jsxs)(e.h2,{id:\"terraform-code\",children:[(0,n.jsx)(e.a,{href:\"#terraform-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform code\"]}),(0,n.jsx)(e.p,{children:\"For Terraform state storage and script execution, we use Terraform Cloud service with a free plan. Therefore, it is essential to provide Azure tenant and subscription data along with the Service Principal data in configuration for every provider. Terraform Cloud agent will use this Service Principal to access and modify resources under a given Azure tenant and subscription.\"}),(0,n.jsx)(e.pre,{className:\"language-hcl\",children:(0,n.jsxs)(e.code,{className:\"language-hcl code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"terraform\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"required_providers\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"azurerm\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"source\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"hashicorp/azurerm\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"version\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"3.26.0\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"azapi\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"source\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Azure/azapi\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"version\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"1.0.0\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"cloud\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"organization\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-devops\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"workspaces\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"azure_container_apps-dev\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"provider\",(0,n.jsx)(e.span,{className:\"token type variable\",children:' \"azurerm\" '})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"features\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"subscription_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-subscription-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-service-principal-client-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_secret\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-service-principal-client-secret\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tenant_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-tenant-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"provider\",(0,n.jsx)(e.span,{className:\"token type variable\",children:' \"azapi\" '})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"subscription_id\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-subscription-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-service-principal-client-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"client_secret\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-service-principal-client-secret\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tenant_id\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\u003cyour-azure-tenant-id\u003e\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"locals\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"             \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"North Europe\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"organization_name\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-devops\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"project_name\"}),\"         \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"aca\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"environment_name\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_name_suffix\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"organization_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\"-\",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"project_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\"-\",(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"environment_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Owner\"}),\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.organization_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Env\"}),\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.environment_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"WorkloadName\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.project_name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"Source\"}),\"       \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Terraform\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"log_settings\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"               \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"PerGB2018\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"retention_in_days\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"daily_quota_gb\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_resource_group\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"resource_group\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"rg-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_log_analytics_workspace\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log_analytics_workspace\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"log-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"                 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.sku\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"retention_in_days\"}),\"   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.retention_in_days\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"daily_quota_gb\"}),\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.log_settings.daily_quota_gb\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azapi_resource\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"resource_managed_environment\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"type\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Microsoft.App/managedEnvironments@2022-03-01\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"menv-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"               \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"parent_id\"}),\"              \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"response_export_values\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"properties.staticIp\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"properties.defaultDomain\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"body\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token property\",children:\"properties\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"appLogsConfiguration\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"destination\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log-analytics\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"logAnalyticsConfiguration\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token property\",children:\"customerId\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_log_analytics_workspace.log_analytics_workspace.workspace_id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sharedKey\"}),\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_log_analytics_workspace.log_analytics_workspace.primary_shared_key\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:\"zoneRedundant\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"ignore_missing_property\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_container_registry\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"container_registry\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"cr',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"replace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"-\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\"           \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"                      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"sku\"}),\"                           \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Basic\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"admin_enabled\"}),\"                 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"public_network_access_enabled\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"network_rule_bypass_option\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"None\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_user_assigned_identity\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"user_assigned_identity\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"name\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string\",children:['\"id-',(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"$\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"local\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token type variable\",children:\"resource_name_suffix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"resource_group_name\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.name\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"location\"}),\"            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_resource_group.resource_group.location\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"tags\"}),\"                \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` local.tags\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token keyword\",children:[\"resource \",(0,n.jsx)(e.span,{className:\"token type variable\",children:'\"azurerm_role_assignment\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"role_assign\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"scope\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_container_registry.container_registry.id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"role_definition_name\"}),\"             \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AcrPull\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"principal_id\"}),\"                     \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),` azurerm_user_assigned_identity.user_assigned_identity.principal_id\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:\"skip_service_principal_aad_check\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"Please mind the \",(0,n.jsx)(e.code,{children:\"ignore_missing_property = true\"}),\" attribute setting for the managed environment resource. Adding this line is necessary to avoid problems with Terraform plan still founding changes after applying the configuration. More about this: \",(0,n.jsx)(e.a,{href:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\",children:\"https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/frequently_asked_questions\"})]}),(0,n.jsxs)(e.h2,{id:\"terraform-cloud\",children:[(0,n.jsx)(e.a,{href:\"#terraform-cloud\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Terraform Cloud\"]}),(0,n.jsx)(e.p,{children:\"This is how the applied configuration looks like inside Terraform Cloud workspace:\"}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-terraform-cloud\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-terraform-cloud.png\",width:\"798\",height:\"1066\"})}),(0,n.jsxs)(e.h2,{id:\"azure-portal\",children:[(0,n.jsx)(e.a,{href:\"#azure-portal\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Azure Portal\"]}),(0,n.jsx)(e.p,{children:\"This is how the applied configuration looks like on the Azure portal:\"}),(0,n.jsx)(e.div,{children:(0,n.jsx)(c,{alt:\"azure-container-apps-infra-azure-portal\",src:\"/static/images/devops/azure-container-apps/azure-container-apps-infra-azure-portal.png\",width:\"729\",height:\"727\"})})]})}function v(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(p,a)})):p(a)}var w=v;function d(a,e){throw new Error(\"Expected \"+(e?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f(A);})();\n;return Component;"},"_id":"blog/devops/azure-container-apps-infra.mdx","_raw":{"sourceFilePath":"blog/devops/azure-container-apps-infra.mdx","sourceFileName":"azure-container-apps-infra.mdx","sourceFileDir":"blog/devops","contentType":"mdx","flattenedPath":"blog/devops/azure-container-apps-infra"},"type":"Blog","readingTime":{"text":"5 min read","minutes":4.05,"time":243000,"words":810},"slug":"devops/azure-container-apps-infra","toc":[{"value":"Overview","url":"#overview","depth":2},{"value":"Intro","url":"#intro","depth":2},{"value":"Required Azure resources","url":"#required-azure-resources","depth":2},{"value":"Terraform AzAPI provider","url":"#terraform-azapi-provider","depth":2},{"value":"Terraform code","url":"#terraform-code","depth":2},{"value":"Terraform Cloud","url":"#terraform-cloud","depth":2},{"value":"Azure Portal","url":"#azure-portal","depth":2}]},"authorDetails":[{"name":"Włodzimierz Kesler","avatar":"/static/images/wlodziu.jpg","occupation":"Team Leader / Senior Cloud Developer","company":"iteo","email":"wgkesler@gmail.com","linkedin":"https://www.linkedin.com/in/wgkesler/","type":"Authors","readingTime":{"text":"1 min read","minutes":0.455,"time":27300,"words":91},"slug":"wlodziu","toc":[]},{"name":"Kornel Warwas","avatar":"/static/images/kornel.jpeg","occupation":"Head of Web","company":"iteo","email":"kornel.warwas@gmail.com","linkedin":"https://www.linkedin.com/in/kornel-warwas/","github":"https://github.com/kwarwas","type":"Authors","readingTime":{"text":"1 min read","minutes":0.385,"time":23100,"words":77},"slug":"kornel","toc":[]}],"prev":{"title":"k3d, Prometheus, Grafana and k6","date":"2022-06-24T20:04:00.000Z","tags":["devops","k8s","k3d","k6"],"lastmod":"2022-06-24T00:00:00.000Z","draft":false,"summary":"In this article we introduce Kubernetes example monitoring solution using k3d, Prometheus and Grafana.","authors":["kornel","wlodziu"],"type":"Blog","readingTime":{"text":"5 min read","minutes":4.77,"time":286200,"words":954},"slug":"devops/k3d-prometheus-grafana","toc":[{"value":"Overview","url":"#overview","depth":2},{"value":"Intro","url":"#intro","depth":2},{"value":"Create single-node cluster","url":"#create-single-node-cluster","depth":2},{"value":"Check single-node cluster","url":"#check-single-node-cluster","depth":2},{"value":"Install kube-prometheus-stack","url":"#install-kube-prometheus-stack","depth":2},{"value":"Check kube-prometheus-stack deployment","url":"#check-kube-prometheus-stack-deployment","depth":2},{"value":"Get Grafana login password","url":"#get-grafana-login-password","depth":2},{"value":"Deploy sample application","url":"#deploy-sample-application","depth":2},{"value":"File structure","url":"#file-structure","depth":3},{"value":"hello-deployment.yml file","url":"#hello-deploymentyml-file","depth":3},{"value":"hello-service.yml file","url":"#hello-serviceyml-file","depth":3},{"value":"Deploy command","url":"#deploy-command","depth":3},{"value":"Check deployment","url":"#check-deployment","depth":3},{"value":"Run some HTTP requests","url":"#run-some-http-requests","depth":2},{"value":"Hello App port forwarding","url":"#hello-app-port-forwarding","depth":3},{"value":"Sample k6 script","url":"#sample-k6-script","depth":3},{"value":"Run k6 tests","url":"#run-k6-tests","depth":3},{"value":"Run Grafana","url":"#run-grafana","depth":2},{"value":"Port forwarding","url":"#port-forwarding","depth":3},{"value":"Login screen","url":"#login-screen","depth":3},{"value":"Dashboards","url":"#dashboards","depth":3},{"value":"Example screen 1","url":"#example-screen-1","depth":3},{"value":"Example screen 2","url":"#example-screen-2","depth":3},{"value":"Destroy Kubernetes cluster","url":"#destroy-kubernetes-cluster","depth":2},{"value":"What about multi-node cluster?","url":"#what-about-multi-node-cluster","depth":2},{"value":"Create multi-node cluster","url":"#create-multi-node-cluster","depth":3},{"value":"Check multi-node cluster","url":"#check-multi-node-cluster","depth":3},{"value":"Deploy kube-prometheus-stack","url":"#deploy-kube-prometheus-stack","depth":3}]},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["devops","azure-container-apps-infra"]},"buildId":"rlcKjeakqd5s7LdfsSEDu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>